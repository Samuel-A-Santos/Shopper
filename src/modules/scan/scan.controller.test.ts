import { FastifyReply } from "fastify";
import { uploadScan, confirmScan, listScans } from "./scan.controller";
import { Scan } from "./scan.model";
import User from "../user/user.model";
import { uploadScanResponseMapping } from "./scan.mapping";

jest.mock("./scan.model");
jest.mock("../user/user.model");
jest.mock("./scan.mapping");

describe("Scan Controller", () => {
  let reply: FastifyReply;

  beforeEach(() => {
    reply = {
      code: jest.fn().mockReturnThis(),
      send: jest.fn().mockReturnThis(),
    } as unknown as FastifyReply;
  });

  afterEach(() => {
    jest.clearAllMocks();
  });

  describe("uploadScan", () => {
    it("should upload a scan and return 200", async () => {
      const body = {
        image: "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",
        measure_datetime: "2023-10-10T00:00:00Z",
        measure_type: "WATER",
        customer_code: "12345",
      };

      const measured_number = 123;
      const newScan = { ...body, measured_number, measure_uuid: "uuid" };
      const user = { customer_code: "12345", scans: [] };

      (Scan.prototype.save as jest.Mock).mockResolvedValue(newScan);
      (User.findOne as jest.Mock).mockResolvedValue(user);
      (uploadScanResponseMapping as jest.Mock).mockReturnValue(newScan);

      await uploadScan(body, reply);

      expect(Scan.prototype.save).toHaveBeenCalled();
      expect(User.findOne).toHaveBeenCalledWith({ customer_code: body.customer_code });
      expect(reply.code).toHaveBeenCalledWith(200);
      expect(reply.send).toHaveBeenCalledWith(newScan);
    });
  });

  // Add similar tests for confirmScan and listScans
});